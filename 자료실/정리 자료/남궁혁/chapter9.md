# 제9장 HTTP에 기능을 추가한 프로토콜

## 9.1 HTTP를 기본으로 하는 프로토콜
- HTTP라는 프로토콜의 제한이나 한계를 극복하기 위해 HTTP를 기반해서 추가한 형태의 새로운 프로토콜 몇 가지가 추가되었다.

## 9.2 HTTP의 병목 현상을 해소하는 SPDY
- HTTP의 병목 현상을 해소하고 웹 페이지 로딩 시간을 50% 단축한다는 목표를 세우고 개발

### HTTP의 병목 현상
- 1개의 커넥션으로 1개의 리퀘스트만 보낼 수 있다.
- 리퀘스트는 클라이언트에서만 시작할 수 있다. 리스폰스만 받는 것은 불가능하다.
- 리퀘스트/리스폰스 헤더를 압축하지 않은 체로 보낸다. 헤더의 정보가 많을수록 지연이 심해진다.
- 장황한 헤더를 보낸다. 매번 같은 헤더를 보내는 것은 낭비다.
- 데이터 압축을 임의로 선택할 수 있다. 압축해서 보내는 것이 강제적이지 는 않다.

### Ajax에 의한 해결 방법
- Ajax(Asynchronous JavaScript+XML)은 JS나 DOM(Document Object Model) 조작 등을 활용하는 방식
- 웹 페이지의 일부분만 고쳐쓸 수 있는 비동기 통신 방법
- 기존의 동기 통신에 비해서 일부분만 갱신되기 때문에 리스폰스로 전송되는 데이터 양은 줄어든다는 장점이 있다.
- XML HttpRequest라는 API로 JS 등의 스크립트 언어로 서버와 HTTP 통신을 할 수 있다.
- 실시간으로 서버에서 정보를 취득하려고 하면 대량의 리퀘스트가 발생한다는 문제점이 있다.

### Comet에 의한 해결 방법
- 서버 측의 콘텐츠에 갱신이 있었을 경우, 클라이언트부터 리퀘스트를 기다리지 않고 클라이언트에 보내기 위한 방법
- 응답을 연장시킴으로써, 서버에서 통신을 개시하는 서버 푸시 기능을 유사하게 따르고 있다.
- Comet에서는 리스폰스를 보류 상태로 해 두고, 서버의 콘텐츠가 갱신되었을 때에 리스폰스를 반환
- 리스폰스를 보류하기 위해서는 커넥션을 유지하는 시간이 길어지고, 리소스를 소비한다.

### SPDY의 목표
- 근본적인 개선을 위해 프로토콜 레벨에서의 개선의 필요성
- SPDY는 HTTP가 안고 있던 병목 현상을 프로토콜 레벨에서 해소하기 위해 개발이 진행되고 있는 프로토콜

### SPDY 설계와 기능
<table style="width: 100%; table-layout: fixed;">
  <tr>
    <th>HTTP</th>
    <th>애플리케이션 계층</th>   
  </tr>
 
  <tr>
    <td>SPDY</td>
    <td>세션 계층</td> 
  </tr>

  <tr>
    <td>SSL</td>
    <td>프리젠테이션 계층</td> 
  </tr>

  <tr>
    <td>TCP</td>
    <td>트랜스포트 계층</td> 
  </tr>
</table>

- TCP/IP의 애플리케이션 계층과 트랜스포트 계층 사이에 새로운 세션 계층을 추가하는 형태로 동작
- SPDY는 보안을 위해 표준으로 SSL을 사용
- SPDY가 세션 계층으로서 데이터의 흐름을 제어하지만, HTTP의 커넥션은 확립되어 있다.
- HTTP의 GET, POST와 같은 메소드나 쿠키, 메시지 등을 그대로 사용할 수 있다.

### 다중화 스트림
- 단일 TCP 접속을 통해서 복수의 HTTP 리퀘스트를 무제한으로 처리할 수 있다.
- TCP의 효율이 높아진다.

### 리퀘스트의 우선 순위 부여
- 무제한으로 리퀘스트를 병렬 처리할 수 있지만, 각 리퀘스트에 우선  순위를 할당할 수 있다.
- 복수의 리퀘스트를 보낼 때  대역폭이 좁으면 처리가 늦어지는 현상을 해결하기 위함

### HTTP 헤더 압축
- 리퀘스트와 리스폰스의 HTTP 헤더를 압축한다.
- 적은 패킷 수와 송신 바이트 수로 통신이 가능.

### 서버 푸시 기능
- 서버에서 클라이언트로 데이터를 푸쉬하는 서버 푸시 기능 지원
- 서버 측은 클라이언트에서 리퀘스트를 기다리지 않고 데이터를 보낼 수 있다.

### 서버 힌트 기능
- 서버가 클라이언트에게 리퀘스트 해야 할 리소스를 제안할 수 있다.

### SPDY는 웹의 병목 현상을 해결하는가?
- 웹 브라우저와 웹 서버는 SPDY에 대응하고 있을 필요가 있다.
- SPDY는 기본적으로 한 개의 도메인과의 통신을 다중화할 뿐이다.
- 하나의 웹 사이트에서 복수의 도메인으로 리소스를 사용하고 있을 경우에는 그 효과는 한정적
- 대부분의 웹 사이트의 문제는 HTTP의 병목 현상 때문만은 아니다.
- 부수적으로 웹 콘텐츠 제작을 개선하는 등 다른 일들이 많다.  

<br>

## 9.3 브라우저에서 양방향 통신을 하는 WebSocket
- **양방향 통신**을 가능하게 하는 프로토콜
- 클라이언트와 서버 간에 **지속적인 연결**을 유지하면서 실시간으로 데이터를 주고받을 수 있다.
- XMLHttpRequest의 결점을 해결하기 위한 기술
  - **전체 응답**을 메모리에 로드한 후에 처리하는 방식, 큰 파일을 전송하거나 응답받을 때, 메모리 효율성이 떨어질 수 있다. 특히 **스트리밍 데이터**나 **진행 상태를 추적**하는 데 어려움

### WebSocket 프로토콜
- 서버 푸시 기능
- 통신량의 삭감
  - 접속을 한 번 확립하면 접속을 유지
  - HTTP에 비해서 자주 접속 시 오버헤드가 적고, 헤더의 사이즈도 작기 때문에 통신량을 줄일 수 있다.
- 핸드쉐이크/리퀘스트
  - HTTP의 Upgrade 헤더 필드를 사용해서 프로토콜을 변경하는 것으로 핸드쉐이크를 실시
- 핸드쉐이크/리스폰스
  - 리퀘스트에 대한 리스폰스는 상대 코드 101 Switching Protocols로 반환
  - 핸드쉐이크에 의해 WebSocket 커넥션이 확립된 후에는 HTTP가 아닌, WebSocket 독자적인 데이터 프레임을 이용해 통신
- WebSocket API
  - JS에서 WebSocket 프로토콜을 사용한 양방향 통신을 하기 위해서는 W3C에서 사양이 책정되어 있는, 제공하고 있는 WebSocket 인터페이스를 사용한다.

<br>

## 9.4 등장이 기다려지는 HTTP/2.0
- 웹 체감 속도의 개선을 목표로 2.0을 만들었다.
- SPDY, HTTP Speed+Mobility, Network-Friendly HTTP Upgrade 가 베이스가 되어 사양이 검토

<br>

## 9.5 웹 서버 상의 파일을 관리하는 WebDAV
- WebDAV는 웹 서버의 콘텐츠에 대해서, 직접 파일 복사나 편집 작업 등을 할 수 있는 분산 파일 시스템
- HTTP/1.1를 확장한 프로토콜

### HTTP/1.1을 확장한 WebDAV
- Collection 컬렉션
  - 여러 개의 리소스를 한꺼번에 관리하기 위한 개념
  - 각종 조작은 컬렉션 단위로 가능
- Resource 자원
  - 파일이나 컬렉션을 리소스라고 부른다.
- Property 프로퍼티
  - 리소스의 프로퍼티를 정의한 것
- Lock 잠금
  - 파일을 편집할 수 없는 상태
  - 여러 명의 사람이 동시에 편집하는 경우 등 동시에 작성되는 걸 예방

### WebDAV에서 추가된 메소드와 상태 코드
- 리모트 관리를 위해 HTTP/1.1에 다음의 메소드가 추가되었다.
    - PROPFIND: 프로퍼티 취득
    - PROPPATCH: 프로퍼티 변경
    - MKCOL: 컬렉션 작성
    - COPY: 리소스 및 프로퍼티 복제
    - MOVE: 리소스 이동
    - LOCK: 리소스 잠금
    - UNLOCK: 리소스 잠금 해제
- 상태 코드의 확장
    - 102 Processing: 리퀘스트는 정상적으로 수신되었지만 아직 처리 중이다.
    - 207 Multi-Status: 복수의 스테이터스를 가지고 있다.
    - 422 Unprocessable Entity: 서식은 올바르지만 내용이 틀리다.
    - 423 Locked: 리소스가 잠겨있다.
    - 424 Failed Dependency: 어떤 리퀘스트와 관련된 리퀘스트가 실패했기 때문에 의존 관계를 유지 못한다.
    - 507 Insufficient Storage: 기억 영역이 부족하다.