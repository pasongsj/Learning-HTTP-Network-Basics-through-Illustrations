## 3.3) 인코딩으로 전송 효율을 높이다

인코딩은 데이터를 전송할 때, 원래 데이터를 효율적으로 전달할 수 있도록 변환하는 과정이다. 이 과정에서 데이터를 압축하거나 분할하여 보내는 등, 전송의 효율성을 높이기 위한 다양한 기법들이 활용된다. 주요 인코딩 기법에는 **압축 콘텐츠 코딩**과 **청크 전송 코딩**이 포함된다.

### 메세지 바디와 엔티티 바디의 차이

- **메세지 바디(Message Body)**: HTTP 메시지의 본문 부분으로, 실제 전송하려는 데이터나 콘텐츠가 포함된다.
- **엔티티 바디(Entity Body)**: 전송되는 리소스의 실질적인 내용이다. 이는 메시지 바디 내에서 전송될 수 있는 데이터 형식으로, 텍스트, 이미지, 비디오 등 다양한 형태로 존재할 수 있다.

| **구분** | **메세지 바디(Message Body)** | **엔티티 바디(Entity Body)** |
| --- | --- | --- |
| **정의** | HTTP 메시지 내의 데이터 본문을 의미 | 전송되는 콘텐츠의 실제 데이터 내용 |
| **사용 위치** | HTTP 메시지 내에 포함된 데이터 | 주로 HTTP 메시지의 바디 안에 포함되는 콘텐츠 |
| **목적** | 전송하려는 데이터를 포함하여 전송의 본문을 형성 | 콘텐츠나 데이터를 전송할 때, 실질적인 내용 |
| **예시** | 텍스트, 이미지, 오디오 등 | 웹페이지 콘텐츠, 파일, JSON, XML 등 |

### 압축해서 보내는 콘텐츠 코딩

콘텐츠 코딩(Content-Encoding)은 데이터를 전송하기 전에 압축하여 전송하는 방법이다. 주로 데이터 전송량을 줄이기 위해 사용됩니다. 대표적인 예시로는 **gzip,** **deflate, compress** 압축 방식이 있다.

클라이언트가 서버에 요청할 때 `Accept-Encoding` 헤더를 통해 압축 형식을 명시할 수 있다. 예를 들어, `Accept-Encoding: gzip, deflate`로 요청하면 서버는 가능한 경우 해당 형식으로 콘텐츠를 압축하여 응답한다.

```
GET /example HTTP/1.1 Host: www.example.com Accept-Encoding: gzip, deflate

HTTP/1.1 200 OK Content-Encoding: gzip Content-Type: text/html

[압축된 HTML 콘텐츠]
```

이렇게 전송되는 압축된 데이터는 클라이언트가 받아서 해제하여 사용하게 된다. 압축을 사용하면 데이터 전송량을 줄여서 효율적인 통신을 할 수 있다.

### 분해해서 보내는 청크 전송 코딩

청크 전송 코딩(Chunked Transfer Encoding)은 데이터를 일정한 크기로 나누어 전송하는 방식이다. 이 방식은 전송할 데이터의 크기를 미리 알 수 없는 경우나, 데이터를 실시간으로 전송해야 할 때 유용하다. HTTP/1.1에서 도입된 이 방식은 데이터를 청크 단위로 나누어 전송하며, 각 청크의 끝에 크기를 나타내는 헤더를 붙인다.

**예시**: 클라이언트가 서버에 요청하고 서버는 데이터를 청크로 나누어 전송한다.

```
HTTP/1.1 200 OK Transfer-Encoding: chunked

4\r\n test\r\n 3\r\n foo\r\n 0\r\n \r\n
```


위 예시에서 "4\r\n test"는 첫 번째 청크(크기 4, 데이터 "test")이고, 그 다음 "3\r\n foo"는 두 번째 청크다. 마지막 청크는 "0\r\n"으로 종료됩니다. `0\r\n`은 데이터의 끝을 나타내는 시그널로 사용된다.


## 3.4) 여러 데이터를 보내는 멀티파트

### MIME (Multipurpose Internet Mail Extensions)

MIME은 이메일의 본문과 첨부파일을 **텍스트 이외의 다양한 형식**으로 인코딩하고 전송할 수 있게 해주는 표준이다.

MIME의 핵심은 이메일의 **헤더**와 **본문**이 여러 형식으로 전달될 수 있도록 정보를 제공하는 것이다. MIME은 기본적으로 이메일을 **다양한 형식의 데이터**를 전송할 수 있도록 확장하며, 텍스트 메시지만 보낼 수 있던 기존의 이메일 시스템을 개선했다.

Content-Type, Content-Transfer-Encoding, Content-Disposition 이 MIME과 관련된 헤더다.

### MIME의 필요성

- **SMTP의 제한 해결**:
    - SMTP는 기본적으로 **7비트 ASCII 문자**만 처리할 수 있다.
    - 하지만 현대 이메일 시스템에서는 **이미지, 오디오 파일, PDF 등 다양한 형식**의 데이터를 전송해야 하므로 **8비트 바이너리 데이터**도 전송할 필요가 있다.
    - MIME은 이 문제를 해결하기 위해 **8비트 데이터를 7비트 텍스트로 변환**하여 전송할 수 있게 합니다.
- **파일 형식 지원**:
    - MIME은 이메일 본문에 **텍스트 외에도 다양한 파일 형식**(이미지, 비디오, 오디오 등)을 포함시킬 수 있게 해준다.
    - 이를 통해 **다양한 콘텐츠 형식**을 **효과적으로 전송**할 수 있다.
- **인코딩 방식 제공**:
    - MIME은 **base64**, **quoted-printable** 등 다양한 **인코딩 방식을 제공**하여 이메일 시스템에서 텍스트와 바이너리 데이터를 모두 전송할 수 있게 해준다.
    - 인코딩을 통해 **8비트 바이너리 데이터를 7비트 텍스트로 변환**하고, 이를 다시 수신자가 해석할 수 있도록 한다.(다만, **모든 MIME 데이터가 반드시 7비트로 변환되는 것은 아니며**, 각 인코딩 방식에 따라 다르게 처리)
- **메일의 다채로운 콘텐츠**:
    - MIME은 이메일에서 **HTML 형식**, **이미지**, **첨부파일** 등을 함께 전송할 수 있도록 하여, 이메일을 **다양한 콘텐츠**를 포함하는 **멀티미디어 형태**로 확장하는 데 중요한 역할을 합니다.

### MIME의 주요 구성 요소:

1. **헤더(Header)**: MIME 메시지는 여러 가지 헤더를 포함한다. 예를 들어, `Content-Type` 헤더는 메시지의 본문이 어떤 형식인지(텍스트, 이미지, 오디오 등)를 지정하며, `Content-Transfer-Encoding` 헤더는 데이터를 어떻게 인코딩할 것인지를 지정한다.
2. **Content-Type**: 이 헤더는 이메일 메시지의 본문에 포함된 데이터의 형식을 정의한다. 예를 들어:
    - `text/plain`: 일반 텍스트 형식
    - `text/html`: HTML 형식
    - `image/jpeg`: JPEG 이미지 형식
    - `audio/mpeg`: MP3 오디오 파일 형식
    - `application/pdf`: PDF 파일 형식
3. **Content-Transfer-Encoding**: 데이터가 어떻게 인코딩되는지 설명하는 헤더로, 예를 들어 `base64` 인코딩은 바이너리 데이터를 ASCII 텍스트로 변환하여 텍스트 기반의 메일 시스템에서 전송할 수 있도록 한다.
4. **Content-Disposition**: 첨부파일을 어떻게 처리할지 지정하는 헤더로, 보통 `inline`(본문 내에 표시) 또는 `attachment`(첨부파일로 처리)로 설정된다. → 추가 조사가 필요함.

### 멀티파트 (Multipart)

멀티파트는 MIME의 본문 전송 방식 중 하나로, 하나의 메시지 안에 여러 개의 다른 콘텐츠가 포함될 수 있도록 한다. 이를 통해 텍스트뿐만 아니라 이미지, 파일, 비디오 등 다양한 콘텐츠가 하나의 이메일에 포함될 수 있다.

(멀티파트(Multipart)는 **MIME**을 바디 영역에서 확장한 개념입니다. 다시 말해, 멀티파트는 MIME의 일부로, 이메일 메시지의 본문을 여러 부분(파트)으로 나누어 서로 다른 형식의 데이터를 함께 전송할 수 있게 해주는 방법)

```
Content-Type: multipart/mixed; boundary="boundary_string"

--boundary_string Content-Type: text/plain

이것은 텍스트 본문입니다.

--boundary_string Content-Type: image/jpeg Content-Disposition: attachment; filename="image.jpg" Content-Transfer-Encoding: base64

(이미지 데이터)

--boundary_string-- ...
```

### MIME과 멀티파트의 관계

- **MIME (Multipurpose Internet Mail Extensions)**: 이메일을 텍스트 외에도 다양한 형식(이미지, 오디오, 비디오, 파일 등)으로 확장한 표준이다. MIME의 주요 기능은 이메일에 다양한 콘텐츠 유형을 정의하고, 이러한 데이터들이 어떻게 인코딩되고 처리될지를 설정한다.
- **멀티파트 (Multipart)**: MIME 메시지 본문 내에서 여러 개의 독립적인 파트를 포함하는 형식으로, 이를 통해 서로 다른 형식의 콘텐츠를 하나의 메시지에 함께 전송할 수 있게 해준다. 즉, 멀티파트는 데이터를 여러 부분으로 나누어 전송하는 **MIME의 전송 포맷**으로, MIME 표준에 따라 이러한 형식이 정의된다.

## 3.5) 일부분만 받는 레인지 리퀘스트

### **Range Request 개요**

**Range Request**는 HTTP에서 클라이언트가 서버에 리소스의 일부 범위만 요청할 수 있도록 해주는 기능이다. 클라이언트는 `Range` 헤더를 사용하여 요청하고, 서버는 요청된 범위만 응답으로 보내준다. 이를 통해 대용량 파일을 부분적으로 다운로드하거나, 중단된 다운로드를 재개할 수 있다.

### **예시**

```
Range: bytes=1000-2000
```

이 요청은 클라이언트가 서버에 파일의 1000번째 바이트부터 2000번째 바이트까지의 범위만 요청하는 것이다.

### **Range Request의 필요성**

1. **다운로드 재개**: 네트워크 오류나 다운로드 중단 시, 이미 다운로드된 부분을 제외한 나머지 부분만 요청하여 다운로드를 재개할 수 있다.
2. **대용량 파일 처리**: 큰 파일을 한 번에 다운로드하는 대신, 작은 범위로 나누어 다운로드할 수 있다. 이를 통해 서버와 클라이언트의 리소스를 효율적으로 사용할 수 있다.
3. **멀티파트 다운로드**: 파일을 여러 부분으로 나누어 병렬 다운로드하여 다운로드 속도를 향상시킬 수 있다.

### **Range Request의 히스토리**

`Range Request`는 파일 전송 프로토콜인 **FTP**에서 유래되었으며, HTTP 프로토콜에서 그 기능이 확장되었다:

- **HTTP/1.0**: 최초로 `Range` 헤더가 도입되어 파일의 일부 범위를 요청할 수 있는 기능이 제공되었다.
- **HTTP/1.1**: `Range` 헤더 사용이 표준화되었고, 부분 콘텐츠를 처리하기 위한 `206 Partial Content` 응답 상태 코드가 추가되었다.
- **사용자 경험 향상**: `Range Request`는 대용량 파일의 다운로드, 스트리밍, 멀티파트 다운로드 등에 사용되어 효율성을 높이고 사용자 경험을 개선했다.

### **Range Request 사용 사례**

**Range Request**는 여러 분야에서 유용하게 사용된다:

- **비디오 스트리밍**: 사용자가 비디오를 스트리밍할 때 필요한 범위만 다운로드하여 시작할 수 있다. 예를 들어, 사용자가 비디오의 1~10분 구간만 보고 싶을 때 해당 구간만 요청하여 빠르게 재생을 시작할 수 있다.
- **다운로드 관리자**: 다운로드 관리자 프로그램은 여러 개의 `Range Request`를 동시에 보내어 파일을 여러 부분으로 나누어 병렬로 다운로드할 수 있다.
